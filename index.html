<!DOCTYPE html>
<html>

<head>
	<title>AI Search Visualizer</title>
	<link rel="icon" href="favicon.jpg">
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!-- Brython 3.9 JS -->
	<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/brython@3.9.1/brython.min.js"></script>
	
	<!-- Fabric.js for infinite canvas -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>
	
	<!-- Tailwind CSS -->
	<script src="https://cdn.tailwindcss.com"></script>
	
	<!-- Lucide Icons -->
	<script src="https://unpkg.com/lucide@latest"></script>
	
	<!-- Tippy.js for tooltips -->
	<script src="https://unpkg.com/@popperjs/core@2"></script>
	<script src="https://unpkg.com/tippy.js@6"></script>
	<link rel="stylesheet" href="https://unpkg.com/tippy.js@6/dist/tippy.css" />
	
	<!-- GIF.js for GIF export -->
	<script src="https://cdn.jsdelivr.net/npm/gif.js@0.2.0/dist/gif.js"></script>
	
	<!-- jsPDF for PDF export -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
	
	<!-- html2canvas for canvas capture -->
	<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

	<!-- GIF Recorder module -->
	<script src="gif-recorder.js"></script>

	<script type="text/python" src="main.py"></script>

	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			overflow: hidden;
			font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
		}

		#canvas-container {
			width: 100vw;
			height: 100vh;
			position: relative;
			cursor: grab;
		}

		#canvas-container:active {
			cursor: grabbing;
		}

		.floating-toolbar {
			position: fixed;
			top: 20px;
			left: 50%;
			transform: translateX(-50%);
			background: rgba(255, 255, 255, 0.95);
			backdrop-filter: blur(10px);
			border-radius: 16px;
			padding: 12px;
			box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
			z-index: 1000;
			display: flex;
			gap: 8px;
			flex-wrap: wrap;
			max-width: 90vw;
		}

		.tool-btn {
			width: 48px;
			height: 48px;
			border-radius: 12px;
			border: 2px solid transparent;
			background: white;
			cursor: pointer;
			display: flex;
			align-items: center;
			justify-content: center;
			transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
			position: relative;
			color: #64748b;
		}

		.tool-btn:hover {
			transform: scale(1.15);
			box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
		}

		.tool-btn.active {
			border-color: #667eea;
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			color: white;
		}

		.tool-btn svg {
			width: 24px;
			height: 24px;
		}

		.divider {
			width: 2px;
			background: #e2e8f0;
			margin: 0 4px;
		}

		.bottom-panel {
			position: fixed;
			bottom: 20px;
			left: 50%;
			transform: translateX(-50%);
			background: rgba(255, 255, 255, 0.95);
			backdrop-filter: blur(10px);
			border-radius: 16px;
			padding: 16px 24px;
			box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
			z-index: 1000;
			max-width: 90vw;
		}

		.algorithm-section {
			margin-bottom: 12px;
		}

		.algorithm-section:last-child {
			margin-bottom: 0;
		}

		.section-title {
			font-size: 12px;
			font-weight: 600;
			color: #64748b;
			margin-bottom: 8px;
			text-transform: uppercase;
			letter-spacing: 0.5px;
		}

		.algo-buttons {
			display: flex;
			gap: 8px;
			flex-wrap: wrap;
		}

		.algo-btn {
			padding: 8px 16px;
			border-radius: 8px;
			border: 2px solid #e2e8f0;
			background: white;
			cursor: pointer;
			font-size: 13px;
			font-weight: 500;
			color: #475569;
			transition: all 0.2s;
		}

		.algo-btn:hover {
			border-color: #667eea;
			color: #667eea;
		}

		.algo-btn.active {
			border-color: #667eea;
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			color: white;
		}

		.solve-btn {
			width: 100%;
			padding: 14px;
			border-radius: 12px;
			border: none;
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			color: white;
			font-weight: 600;
			font-size: 16px;
			cursor: pointer;
			margin-top: 16px;
			transition: all 0.3s;
		}

		.solve-btn:hover {
			transform: translateY(-2px);
			box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
		}

		.export-panel {
			position: fixed;
			top: 20px;
			right: 20px;
			background: rgba(255, 255, 255, 0.95);
			backdrop-filter: blur(10px);
			border-radius: 16px;
			padding: 12px;
			box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
			z-index: 1000;
			display: flex;
			flex-direction: column;
			gap: 8px;
		}

		.export-btn {
			padding: 10px 16px;
			border-radius: 8px;
			border: 2px solid #e2e8f0;
			background: white;
			cursor: pointer;
			font-size: 13px;
			font-weight: 500;
			color: #475569;
			transition: all 0.2s;
			display: flex;
			align-items: center;
			gap: 8px;
		}

		.export-btn:hover {
			border-color: #10b981;
			color: #10b981;
			transform: translateX(-4px);
		}

		.help-btn {
			position: fixed;
			bottom: 20px;
			right: 20px;
			width: 56px;
			height: 56px;
			border-radius: 50%;
			border: none;
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			color: white;
			cursor: pointer;
			box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
			transition: all 0.3s;
			display: flex;
			align-items: center;
			justify-content: center;
		}

		.help-btn:hover {
			transform: scale(1.1) rotate(15deg);
		}

		.modal {
			display: none;
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: rgba(0, 0, 0, 0.6);
			backdrop-filter: blur(4px);
			z-index: 2000;
			align-items: center;
			justify-content: center;
		}

		.modal.active {
			display: flex;
		}

		.modal-content {
			background: white;
			border-radius: 20px;
			padding: 32px;
			max-width: 600px;
			max-height: 80vh;
			overflow-y: auto;
			box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
			animation: modalSlideIn 0.3s ease-out;
		}

		@keyframes modalSlideIn {
			from {
				opacity: 0;
				transform: translateY(-50px);
			}
			to {
				opacity: 1;
				transform: translateY(0);
			}
		}

		.modal-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 20px;
		}

		.modal-title {
			font-size: 24px;
			font-weight: 700;
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			background-clip: text;
			-webkit-background-clip: text;
			-webkit-text-fill-color: transparent;
		}

		.close-btn {
			width: 32px;
			height: 32px;
			border-radius: 8px;
			border: none;
			background: #f1f5f9;
			cursor: pointer;
			display: flex;
			align-items: center;
			justify-content: center;
			transition: all 0.2s;
		}

		.close-btn:hover {
			background: #e2e8f0;
			transform: rotate(90deg);
		}

		.zoom-controls {
			position: fixed;
			bottom: 20px;
			left: 20px;
			background: rgba(255, 255, 255, 0.95);
			backdrop-filter: blur(10px);
			border-radius: 12px;
			padding: 8px;
			box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
			z-index: 1000;
			display: flex;
			flex-direction: column;
			gap: 8px;
		}

		.zoom-btn {
			width: 40px;
			height: 40px;
			border-radius: 8px;
			border: 2px solid #e2e8f0;
			background: white;
			cursor: pointer;
			display: flex;
			align-items: center;
			justify-content: center;
			transition: all 0.2s;
			color: #64748b;
		}

		.zoom-btn:hover {
			border-color: #667eea;
			color: #667eea;
			transform: scale(1.1);
		}
	</style>
</head>

<body onload="brython()">

	<!-- Floating Toolbar -->
	<div class="floating-toolbar">
		<!-- Tools Section -->
		<button class="tool-btn active" id="add_node" data-tippy-content="Add Node (Click on canvas)">
			<i data-lucide="plus-circle"></i>
		</button>
		<button class="tool-btn" id="add_edge" data-tippy-content="Add Edge (Click two nodes)">
			<i data-lucide="git-branch"></i>
		</button>
		<button class="tool-btn" id="delete_node" data-tippy-content="Delete Node">
			<i data-lucide="trash-2"></i>
		</button>
		<button class="tool-btn" id="delete_edge" data-tippy-content="Delete Edge">
			<i data-lucide="scissors"></i>
		</button>
		
		<div class="divider"></div>
		
		<button class="tool-btn" id="toggle_goal" data-tippy-content="Toggle Goal State">
			<i data-lucide="flag"></i>
		</button>
		<button class="tool-btn" id="update_heuristic" data-tippy-content="Set Heuristic">
			<i data-lucide="hash"></i>
		</button>
		<button class="tool-btn" id="update_weight" data-tippy-content="Set Edge Weight">
			<i data-lucide="weight"></i>
		</button>
		
		<div class="divider"></div>
		
		<!-- Graph Type -->
		<button class="tool-btn active" id="undirected_graph" data-tippy-content="Undirected Graph">
			<i data-lucide="minus"></i>
		</button>
		<button class="tool-btn" id="directed_graph" data-tippy-content="Directed Graph">
			<i data-lucide="arrow-right"></i>
		</button>
	</div>

	<!-- Export Panel -->
	<div class="export-panel">
		<button class="export-btn" id="export_png">
			<i data-lucide="image"></i>
			PNG
		</button>
		<button class="export-btn" id="export_gif">
			<i data-lucide="film"></i>
			GIF
		</button>
		<button class="export-btn" id="export_pdf">
			<i data-lucide="file-text"></i>
			PDF
		</button>
	</div>

	<!-- Canvas Container -->
	<div id="canvas-container">
		<canvas id="canvas"></canvas>
	</div>

	<!-- Zoom Controls -->
	<div class="zoom-controls">
		<button class="zoom-btn" id="zoom_in" data-tippy-content="Zoom In">
			<i data-lucide="zoom-in"></i>
		</button>
		<button class="zoom-btn" id="zoom_reset" data-tippy-content="Reset View">
			<i data-lucide="maximize"></i>
		</button>
		<button class="zoom-btn" id="zoom_out" data-tippy-content="Zoom Out">
			<i data-lucide="zoom-out"></i>
		</button>
	</div>

	<!-- Bottom Panel (Algorithms) -->
	<div class="bottom-panel">
		<div class="algorithm-section">
			<div class="section-title">Uninformed Search</div>
			<div class="algo-buttons">
				<button class="algo-btn active" id="breadth-first">Breadth First</button>
				<button class="algo-btn" id="depth-first">Depth First</button>
				<button class="algo-btn" id="depth-limit">Depth Limit</button>
				<button class="algo-btn" id="iterative-deepening">Iterative Deepening</button>
				<button class="algo-btn" id="uniform-cost">Uniform Cost</button>
			</div>
		</div>
		
		<div class="algorithm-section">
			<div class="section-title">Informed Search</div>
			<div class="algo-buttons">
				<button class="algo-btn" id="greedy">Greedy</button>
				<button class="algo-btn" id="a*">A*</button>
			</div>
		</div>

		<button class="solve-btn" id="solve">🚀 Start Search</button>
	</div>

	<!-- Help Button -->
	<button class="help-btn" id="help_btn" data-tippy-content="Help & Instructions">
		<i data-lucide="help-circle"></i>
	</button>

	<!-- Help Modal -->
	<div class="modal" id="help-modal">
		<div class="modal-content">
			<div class="modal-header">
				<h2 class="modal-title">Help & Instructions</h2>
				<button class="close-btn" id="close_help">
					<i data-lucide="x"></i>
				</button>
			</div>
			<div class="modal-body">
				<h3 style="margin-bottom: 12px; font-weight: 600; color: #1e293b;">🎨 Building Your Graph</h3>
				<ul style="margin-bottom: 24px; padding-left: 20px; color: #475569; line-height: 1.8;">
					<li><strong>Add Node:</strong> Click anywhere on the canvas</li>
					<li><strong>Add Edge:</strong> Click two nodes to connect them</li>
					<li><strong>Delete Node/Edge:</strong> Select the tool, then click the target</li>
					<li><strong>Set Goal:</strong> Click on any node (except source) to toggle goal state</li>
					<li><strong>Set Weights:</strong> Click the edge weight text to modify</li>
					<li><strong>Set Heuristics:</strong> Click nodes to set their heuristic values</li>
				</ul>

				<h3 style="margin-bottom: 12px; font-weight: 600; color: #1e293b;">🔍 Navigation</h3>
				<ul style="margin-bottom: 24px; padding-left: 20px; color: #475569; line-height: 1.8;">
					<li><strong>Pan:</strong> Click and drag on empty canvas space</li>
					<li><strong>Zoom:</strong> Use mouse wheel or zoom controls</li>
					<li><strong>Reset View:</strong> Click the maximize icon in zoom controls</li>
				</ul>

				<h3 style="margin-bottom: 12px; font-weight: 600; color: #1e293b;">🎬 Running Algorithms</h3>
				<ul style="margin-bottom: 24px; padding-left: 20px; color: #475569; line-height: 1.8;">
					<li>Select an algorithm from the bottom panel</li>
					<li>Click "Start Search" to visualize the algorithm</li>
					<li>Watch as nodes turn purple (visited) and orange (solution path)</li>
				</ul>

				<h3 style="margin-bottom: 12px; font-weight: 600; color: #1e293b;">💾 Exporting</h3>
				<ul style="padding-left: 20px; color: #475569; line-height: 1.8;">
					<li><strong>PNG:</strong> Export current view as image</li>
					<li><strong>GIF:</strong> Record the algorithm animation</li>
					<li><strong>PDF:</strong> Save as PDF document</li>
				</ul>
			</div>
		</div>
	</div>

	<!-- Weights Input Modal -->
	<dialog id="weights-modal" style="border: none; border-radius: 16px; padding: 24px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);">
		<form id="weights-form">
			<h3 style="margin-bottom: 16px; font-weight: 600;">Enter Value</h3>
			<div style="display: flex; gap: 12px; align-items: center;">
				<input id="weights-input" type="number" placeholder="1" min="1" required
					style="padding: 10px 14px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px; width: 120px;">
				<button id="weights-update" type="button" 
					style="padding: 10px 20px; border: none; border-radius: 8px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; font-weight: 500; cursor: pointer;">
					Update
				</button>
				<button id="weights-close" type="button"
					style="padding: 10px 20px; border: 2px solid #e2e8f0; border-radius: 8px; background: white; color: #475569; font-weight: 500; cursor: pointer;">
					Cancel
				</button>
			</div>
		</form>
	</dialog>

	<script>
		// Initialize Lucide icons
		lucide.createIcons();

		// Initialize Tippy tooltips
		tippy('[data-tippy-content]', {
			placement: 'bottom',
			animation: 'scale',
			duration: 200,
		});

		// Tool button interactions
		document.querySelectorAll('.tool-btn').forEach(btn => {
			btn.addEventListener('click', function() {
				// Only handle active state for tool buttons, not graph type buttons
				if (!this.id.includes('graph')) {
					document.querySelectorAll('.tool-btn').forEach(b => {
						if (!b.id.includes('graph')) {
							b.classList.remove('active');
						}
					});
					this.classList.add('active');
				} else {
					// Handle graph type toggle
					document.getElementById('undirected_graph').classList.remove('active');
					document.getElementById('directed_graph').classList.remove('active');
					this.classList.add('active');
				}
			});
		});

		// Algorithm button interactions
		document.querySelectorAll('.algo-btn').forEach(btn => {
			btn.addEventListener('click', function() {
				document.querySelectorAll('.algo-btn').forEach(b => b.classList.remove('active'));
				this.classList.add('active');
			});
		});

		// Help modal
		document.getElementById('help_btn').addEventListener('click', () => {
			document.getElementById('help-modal').classList.add('active');
			lucide.createIcons(); // Refresh icons in modal
		});

		document.getElementById('close_help').addEventListener('click', () => {
			document.getElementById('help-modal').classList.remove('active');
		});

		document.getElementById('help-modal').addEventListener('click', (e) => {
			if (e.target.id === 'help-modal') {
				document.getElementById('help-modal').classList.remove('active');
			}
		});

		// Export functionality
		document.getElementById('export_png').addEventListener('click', () => {
			const canvas = document.getElementById('canvas');
			const link = document.createElement('a');
			link.download = `ai-search-${Date.now()}.png`;
			link.href = canvas.toDataURL();
			link.click();
		});

		document.getElementById('export_pdf').addEventListener('click', async () => {
			const canvas = document.getElementById('canvas');
			const imgData = canvas.toDataURL('image/png');
			const { jsPDF } = window.jspdf;
			const pdf = new jsPDF({
				orientation: canvas.width > canvas.height ? 'landscape' : 'portrait',
				unit: 'px',
				format: [canvas.width, canvas.height]
			});
			pdf.addImage(imgData, 'PNG', 0, 0, canvas.width, canvas.height);
			pdf.save(`ai-search-${Date.now()}.pdf`);
		});

		// GIF export (placeholder - needs implementation with recording)
		document.getElementById('export_gif').addEventListener('click', () => {
			alert('GIF recording will start when you click "Start Search". The recording will be automatically saved when the algorithm completes.');
		});

		// Zoom controls
		let zoomLevel = 1;
		document.getElementById('zoom_in').addEventListener('click', () => {
			zoomLevel = Math.min(zoomLevel + 0.2, 3);
			// Apply zoom to canvas
		});

		document.getElementById('zoom_out').addEventListener('click', () => {
			zoomLevel = Math.max(zoomLevel - 0.2, 0.3);
			// Apply zoom to canvas
		});

		document.getElementById('zoom_reset').addEventListener('click', () => {
			zoomLevel = 1;
			// Reset canvas view
		});
	</script>

</body>

</html>
